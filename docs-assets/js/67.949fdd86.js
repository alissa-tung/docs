(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{525:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"使用-docker-和-ssh-快速部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-和-ssh-快速部署"}},[s._v("#")]),s._v(" 使用 Docker 和 SSH 快速部署")]),s._v(" "),a("p",[s._v("本文描述了如何使用 docker 和 ssh 快速部署 HStreamDB 集群。")]),s._v(" "),a("h2",{attrs:{id:"部署要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署要求"}},[s._v("#")]),s._v(" 部署要求")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("要求本地主机能通过 SSH 与远端服务器建立连接")])]),s._v(" "),a("li",[a("p",[s._v("使用 SSH config file 来辅助建立连接")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://linuxize.com/post/using-the-ssh-config-file/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Reference"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[a("p",[s._v("远端服务器需要安装好 Docker")])])]),s._v(" "),a("h2",{attrs:{id:"获取启动脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取启动脚本"}},[s._v("#")]),s._v(" 获取启动脚本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" script\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O script/dev-deploy https://raw.githubusercontent.com/hstreamdb/hstream/main/script/dev-deploy\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O script/dev_deploy_conf_example.json https://raw.githubusercontent.com/hstreamdb/hstream/main/script/dev_deploy_conf_example.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"创建启动配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建启动配置文件"}},[s._v("#")]),s._v(" 创建启动配置文件")]),s._v(" "),a("p",[s._v("需要创建一个 json 格式的配置文件。配置文件的内容清参考模板："),a("code",[s._v("script/dev_deploy_conf_example.json")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host1"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.1"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host2"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.2"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host3"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.3"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host4"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.10.4"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local_store_config_path"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v('/logdevice.conf"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hstreamdb_config_path"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zookeeper-host"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host2"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host3"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host4"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hstore-host"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host3"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hstore-admin-host"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hserver-host"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host3"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote_ssh_host4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("ul",[a("li",[a("p",[a("code",[s._v("hosts")]),s._v("：hosts 字段以键-值对的形式存储服务器信息。键是SSH配置文件中服务器的HostName，值是服务器的IP地址。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("local_store_config_path")]),s._v("：该字段中需要填入 "),a("code",[s._v("hstore")]),s._v(" 配置文件的路径")]),s._v(" "),a("ul",[a("li",[s._v("具体可以参考 "),a("RouterLink",{attrs:{to:"/zh/latest/deployment/deploy-docker.html"}},[s._v("configuration file")]),s._v(" 中"),a("code",[s._v("创建配置文件")]),s._v("部分")],1)])]),s._v(" "),a("li",[a("p",[a("code",[s._v("hstreamdb_config_path")]),s._v("：该字段中需要填入 "),a("code",[s._v("hstreamdb")]),s._v(" 配置文件的路径")]),s._v(" "),a("ul",[a("li",[s._v("具体可以参考 "),a("RouterLink",{attrs:{to:"/zh/latest/reference/config.html"}},[s._v("HStreamDB Configuration")])],1),s._v(" "),a("li",[s._v("注意：该字段是一个选填字段，如果不填入任何值，则会使用默认配置项进行启动")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("zookeeper-host")]),s._v("：指定创建 Zookeeper 实例的远端服务器节点。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("注意")]),s._v("：检查 "),a("code",[s._v("hstore")]),s._v(" 配置文件中 zk 相关的字段，确保填写的服务器信息一致")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("hstore-host")]),s._v("：指定创建 hstore 实例的远端服务器节点。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("hstore-admin-host")]),s._v("：指定创建 hadmin 实例的远端服务器节点。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("hserver-host")]),s._v("：指定创建 hserver 实例的远端服务器节点。")])])]),s._v(" "),a("h2",{attrs:{id:"集群管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群管理"}},[s._v("#")]),s._v(" 集群管理")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在创建完配置文件之后，可以通过以下指令来启动/停止一个 HStreamDB 集群")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动集群")]),s._v("\ndev-deploy --remote "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" simple --config config_path start\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止集群：只停止启动的容器")]),s._v("\ndev-deploy --remote "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" simple --config config_path stop\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除集群：停止启动的容器，同时移除持久化的所有数据")]),s._v("\ndev-deploy --remote "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" simple --config config_path remove\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);